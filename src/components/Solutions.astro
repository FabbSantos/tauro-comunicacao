---
import SolutionCard from './SolutionCard.astro';
import wpp from '../assets/wpp.png';
import sms from '../assets/sms.png';
import Button from './Button.astro';

const solutions = [
	{
		icon: wpp.src,
		title: 'WhatsApp Marketing',
		description:
			'Conecte-se diretamente com seus clientes através do aplicativo de mensagens mais usado do Brasil.',
		features: [
			'98% das mensagens são lidas em até 3 minutos.',
			'Comunicação instantânea e próxima.',
			'Engajamento real e alto índice de geração de leads.',
		],
		gradient:
			'bg-gradient-to-br from-primary-cyan/40 via-primary-blue/40 to-primary-purple/40',
		href: '/whatsapp',
	},
	{
		icon: sms.src,
		title: 'SMS Marketing',
		description:
			'Alcance 100% dos seus clientes com mensagens instantâneas e alta taxa de entrega.',
		features: [
			'Cobertura Nacional: Envie para qualquer operadora com alta taxa de entrega.',
			'Ideal para lembretes, alertas e campanhas.',
			'Relatórios: Acompanhe status de entrega e conversões rapidamente.',
		],
		gradient:
			'bg-gradient-to-br from-primary-cyan/40 via-primary-blue/40 to-primary-purple/40',
		href: '/sms',
	}
];
---

<section
	id='solucoes'
	class='py-14 relative overflow-hidden bg-gradient-to-bl from-[#020211] to-[#1e144b]'
>
	<div class='container mx-auto px-6 relative z-10'>
		<!-- Section Header -->
		<div class='text-center mb-16 space-y-4'>
			<h2 class='text-4xl md:text-5xl font-bold pb-6'>
				<span class=''> Nossas Soluções </span>
			</h2>
			<p class='text-xl text-white/70 max-w-2xl mx-auto'>
				Ferramentas poderosas para transformar sua comunicação e
				impulsionar suas vendas
			</p>
		</div>

		<!-- Solutions Grid -->
		<div class='grid md:grid-cols-2 gap-8'>
			{solutions.map((solution) => <SolutionCard {...solution} />)}
		</div>

		<!-- CTA Section -->
		<div class='mt-20 text-center'>
			<div
				class='inline-block bg-black/40 backdrop-blur-sm rounded-2xl p-12 shadow-lg shadow-primary-cyan/10'
			>
				<h3 class='text-3xl font-bold mb-4 text-white'>
					Pronto para começar?
				</h3>
				<p class='text-white/70 mb-8 max-w-md mx-auto'>
					Entre em contato e descubra como podemos ajudar seu negócio
					a crescer
				</p>

				<!-- Formulário de contato -->
				<form
					id="contato"
					class='max-w-xl mx-auto mb-10 space-y-5'
				>
					<div class='grid md:grid-cols-2 gap-5'>
						<div class='flex flex-col text-left'>
							<label
								for='nome'
								class='text-xs font-semibold text-white/60 mb-1'
							>
								Nome
							</label>
							<input
								id='nome'
								name='nome'
								type='text'
								required
								placeholder='Seu nome'
								class='w-full px-5 py-3 bg-black/40 backdrop-blur-sm rounded-xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-primary-cyan/40 text-white placeholder-white/40 text-sm'
							/>
						</div>
						<div class='flex flex-col text-left'>
							<label
								for='email'
								class='text-xs font-semibold text-white/60 mb-1'
							>
								E-mail
							</label>
							<input
								id='email'
								name='email'
								type='email'
								required
								placeholder='voce@empresa.com'
								class='w-full px-5 py-3 bg-black/40 backdrop-blur-sm rounded-xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-primary-cyan/40 text-white placeholder-white/40 text-sm'
							/>
						</div>
					</div>
					<div class='flex flex-col text-left'>
						<label
							for='telefone'
							class='text-xs font-semibold text-white/60 mb-1'
						>
							Telefone
						</label>
						<input
							id='telefone'
							name='telefone'
							type='tel'
							placeholder='(11) 99999-0000'
							class='w-full px-5 py-3 bg-black/40 backdrop-blur-sm rounded-xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-primary-cyan/40 text-white placeholder-white/40 text-sm'
						/>
					</div>
					<div class='flex flex-col text-left'>
						<label
							for='mensagem'
							class='text-xs font-semibold text-white/60 mb-1'
						>
							Mensagem
						</label>
						<textarea
							id='mensagem'
							name='mensagem'
							rows='4'
							placeholder='Fale brevemente sobre sua necessidade'
							class='w-full px-5 py-3 bg-black/40 backdrop-blur-sm rounded-xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-primary-cyan/40 text-white placeholder-white/40 text-sm'
						></textarea>
					</div>

					<!-- Campos ocultos do Formspree -->
					<input type="hidden" name="_subject" value="Novo contato - Tauro Comunicação" />
					<input type="text" name="_gotcha" class="hidden" />

					<div class='pt-2'>
							<Button class='w-full py-3' id='submit-btn'>
								<span id='btn-text'>Enviar Mensagem</span>
								<span id='btn-loading' class='hidden'>Enviando...</span>
							</Button>
					</div>
				</form>

				<div id="form-status" class="hidden mt-4 p-4 rounded-lg"></div>
			</div>
		</div>
	</div>
</section>

<script>
	const form = document.getElementById('contato') as HTMLFormElement;
	const status = document.getElementById('form-status') as HTMLDivElement;
	const btnText = document.getElementById('btn-text') as HTMLSpanElement;
	const btnLoading = document.getElementById('btn-loading') as HTMLSpanElement;
	const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

	form?.addEventListener('submit', async (e) => {
		e.preventDefault();

		// Desabilitar botão e mostrar loading
		submitBtn.disabled = true;
		btnText.classList.add('hidden');
		btnLoading.classList.remove('hidden');

		const formData = new FormData(form);
		const data = {
			nome: formData.get('nome'),
			email: formData.get('email'),
			telefone: formData.get('telefone'),
			mensagem: formData.get('mensagem'),
		};

		try {
			const response = await fetch('/api/send-email', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			if (response.ok) {
				status.innerHTML = '✅ Mensagem enviada com sucesso! Entraremos em contato em breve.';
				status.className = 'mt-4 p-4 rounded-lg bg-green-500/20 text-green-400 border border-green-500/40';
				status.classList.remove('hidden');
				form.reset();
			} else {
				throw new Error('Erro ao enviar');
			}
		} catch (error) {
			status.innerHTML = '❌ Erro ao enviar mensagem. Tente novamente.';
			status.className = 'mt-4 p-4 rounded-lg bg-red-500/20 text-red-400 border border-red-500/40';
			status.classList.remove('hidden');
		} finally {
			// Reabilitar botão
			submitBtn.disabled = false;
			btnText.classList.remove('hidden');
			btnLoading.classList.add('hidden');
		}

		setTimeout(() => status.classList.add('hidden'), 5000);
	});
</script>
